<!DOCTYPE html>
<html>

    <head>
        <script src="static/bigint.js"></script>
        <script src="static/jsbn.js"></script>
        <script src="static/sha256.js"></script>
        <script src="static/srp_client.js"></script>

        <script type="text/javascript">

            var hexString_N = null;
            var N = null;
            var g = null;
            var k = null;
            var k_decimal = null;

            var username = null;
            var password = null;

            var username_pad = null;

            //param args must be list
            function _hash(args){
                function upd(accumulator, element){
                    console.log("++++++++++++++++++")
                    console.log("upd-ele| ", element);
                    console.log("ele-typ| ", typeof(element));
                    
                    var hex_element = null;

                    if(typeof(element) === "object" && element.constructor == BigInteger){
                        hex_element = element.toString(16);
                    }
                    else if(typeof(element) === "number"){
                        hex_element = element.toString(16);
                    }
                    else if(typeof(element) === "string"){
                        hex_element = element;
                    }
                    else{
                        throw "_hash element type not valid";
                    }
                    console.log("accumulator + hex_element", accumulator + hex_element);
                    return accumulator + hex_element;
                }

                var hashparam = args.reduce(upd, "");
                var hashresult = CryptoJS.SHA256(hashparam).toString();
                var bigResult = new BigInteger(hashresult, 16);

                console.log('hashresult ', hashresult);
                console.log('bigresult ', bigResult.toString());

                return bigResult;
            }


            function getRandomInt(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }


            function init() {
                var hash = CryptoJS.SHA256("doge");
                document.getElementById('hashValue').innerHTML=hash;
                
                hexString_N = 'EEAF0AB9ADB38DD69C33F80AFA8FC5E86072618775FF3C0B9EA2314C9C256576D674DF7496EA81D3383B4813D692C6E0E0D5D8E250B98BE48E495C1D6089DAD15DC7D7B46154D6B6CE8EF4AD69B15D4982559B297BCF1885C529F566660E57EC68EDBC3C05726CC02FD4CBF4976EAA9AFD5138FE8376435B9FC61D2FC0EB06E3';

                N = new BigInteger(hexString_N, 16);
                g = 2;
                k = _hash([N.toString(10),g]);

                console.log("----------------------------------------------------------");
                console.log("N type | ", typeof(N));
                console.log("N-str  | ", N.toString())
                console.log("N      | ", N);
                console.log("hash(N)| ", CryptoJS.SHA256(N.toString(10)).toString());
                console.log("----------------------------------------------------------");
                console.log("g type | ", typeof(g));
                console.log("g      | ", g);
                console.log("----------------------------------------------------------");
                console.log("k type | ", typeof(k));
                console.log("k-str  | ", k.toString())
                console.log("k      | ", k);
                console.log("----------------------------------------------------------");


                document.getElementById('hexString_N').innerHTML=hexString_N;
                document.getElementById('N').innerHTML=N;
                document.getElementById('g').innerHTML=g;
                document.getElementById('k').innerHTML=k;


            }

            function onSubmit() {
                username = document.getElementById("username").value;
                password = document.getElementById("password").value;

                username_pad = username + getRandomInt(0, Math.pow(256, 2));
                salt = getRandomInt(0, Math.pow)
                document.getElementById('username_pad').innerHTML=username_pad;
                
            }

        </script>

    </head>

    <body onload="init()">
        <p>Register! (username, password):</p>
        <form>
            <input type="text" id="username">
            <input type="password" id="password">
            <button type="button" onclick="onSubmit()">Register</button>
        </form>

        <br>
        Hash value of doge:
        <div id="hashValue"></div>

        <br>
        hexString_N:
        <div id="hexString_N"></div>

        <br>
        N:
        <div id="N"></div>

        <br>
        g:
        <div id="g"></div>

        <br>
        k:
        <div id="k"></div>

        <br>
        username_pad (I):
        <div id="username_pad"></div>

        <br>
        salt:
        <div id="salt"></div>

        <br>
        x = hash(s, p)
        <div id="x"></div>

        <br>
        v = g^x
        <div id="v"></div>

    </body>

</html>